"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("react/jsx-runtime"),R=require("axios"),r=require("react"),h=require("react-router-dom");var u=(e=>(e.NotSure="not_sure",e.LoggedIn="logged_in",e.NotLoggedIn="not_logged_in",e.LoggedOut="logged_out",e))(u||{});const k=r.createContext({status:u.NotSure,setStatus:()=>null,user:null,setUser:()=>null,token:null,setToken:()=>null,fetchUser:()=>null,loginPath:"/login",logoutRedirectPath:"/",defaultAxiosOptions:null}),I=(e,t)=>{const[o,n]=r.useState(()=>{const i=localStorage.getItem(e);try{return i?JSON.parse(i):t}catch(c){return console.error("Invalid JSON:",c),t}});return r.useEffect(()=>{localStorage.setItem(e,o?JSON.stringify(o):"{}")},[e,o]),[o,n]};function O({children:e,fetchUserInterval:t=0,getCurrentUserPath:o="/user",loginPath:n="/login",logoutRedirectPath:i="/",defaultAxiosOptions:c={}}){const a=r.useRef(),[L,g]=I("auth_status",u.NotSure),[v,A]=I("auth_user",null),[S,U]=I("auth_token",null),[N,x]=r.useState(0);S&&(R.defaults.headers.Authorization=`Bearer ${S}`);const f=r.useCallback(()=>{a.current=R.get(o,c).then(l=>{g(u.LoggedIn),A(l.data)}).catch(l=>{console.error(l),g(u.NotLoggedIn)})},[]);if(r.useEffect(()=>{f()},[f,N]),r.useEffect(()=>{let l=0;return t>0&&(l=window.setInterval(f,Math.max(t,3e3))),()=>{clearInterval(l)}},[f,t]),L===u.NotSure&&a.current)throw a.current;return p.jsx(k.Provider,{value:{status:L,setStatus:g,user:v,setUser:A,token:S,setToken:U,fetchUser:()=>x(l=>l+1),loginPath:n,logoutRedirectPath:i,defaultAxiosOptions:c},children:e})}function d(){return r.useContext(k)}function P({to:e}){var n,i;const t=d(),o=h.useLocation();return t.status===u.LoggedIn?p.jsx(h.Navigate,{to:((i=(n=o.state)==null?void 0:n.from)==null?void 0:i.pathname)||e||"/"}):null}function b({children:e}){const t=d(),o=h.useLocation(),n=h.useNavigate();return r.useEffect(()=>{t.status===u.LoggedOut&&(n(t.logoutRedirectPath),t.setStatus(u.NotLoggedIn))},[t,n]),t.status===u.NotLoggedIn?p.jsx(h.Navigate,{to:t.loginPath,state:{from:o}}):p.jsx(p.Fragment,{children:e})}function q(e,t){const{errorHandler:o=s=>console.error(s),apiUrl:n="/login",getUserFromResponse:i=s=>s==null?void 0:s.user,getJwtTokenFromResponse:c=s=>{var m;return((m=s==null?void 0:s.token)==null?void 0:m.token)||(s==null?void 0:s.token)},actionAxiosOptions:a=null}=t||{},{setStatus:L,setUser:g,setToken:v,fetchUser:A,defaultAxiosOptions:S}=d(),[U,N]=r.useState(!1),[x,f]=r.useState(null);return{submit:()=>{N(!0),R.post(n,e,a||S||{}).then(s=>{L(u.LoggedIn),typeof i=="function"?g(i(s.data)):A(),typeof c=="function"&&v(c(s.data)),f(null)}).catch(s=>{var m;f(((m=s.response)==null?void 0:m.data)||s.message||"Unknown error"),o&&o(s)}).finally(()=>{N(!1)})},loading:U,errors:x}}function _(e){const{errorHandler:t=g=>console.error(g),apiUrl:o="/logout"}=e||{},{setStatus:n,setUser:i}=d(),[c,a]=r.useState(!1);return{submit:()=>{a(!0),R.post(o).then(()=>{n(u.LoggedOut),i(null)}).catch(t).finally(()=>{a(!1)})},loading:c}}function j(e,t){const{apiUrl:o="/register",...n}=t||{};return q(e,{apiUrl:o,...n})}function y(){const e=d(),t=h.useLocation(),o=h.useNavigate();return r.useCallback(()=>e.status===u.NotLoggedIn?(o(e.loginPath,{state:{from:t}}),!1):!0,[e,t,o])}exports.AuthProvider=O;exports.AuthStatus=u;exports.RedirectAfterAuth=P;exports.RequireAuth=b;exports.useAuth=d;exports.useLogin=q;exports.useLogout=_;exports.useRegister=j;exports.useRequireAuth=y;
