"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("react/jsx-runtime"),N=require("axios"),u=require("react"),h=require("react-router-dom");var r=(e=>(e.NotSure="not_sure",e.LoggedIn="logged_in",e.NotLoggedIn="not_logged_in",e.LoggedOut="logged_out",e))(r||{});const I=u.createContext({status:r.NotSure,setStatus:()=>null,user:null,setUser:()=>null,token:null,setToken:()=>null,fetchUser:()=>null,loginPath:"/login",logoutRedirectPath:"/",defaultAxiosOptions:null}),k=(e,t)=>{const[o,n]=u.useState(()=>{const i=localStorage.getItem(e);return i?JSON.parse(i):t});return u.useEffect(()=>{localStorage.setItem(e,JSON.stringify(o))},[e,o]),[o,n]};function O({children:e,fetchUserInterval:t=0,getCurrentUserPath:o="/user",loginPath:n="/login",logoutRedirectPath:i="/",defaultAxiosOptions:a={}}){const c=u.useRef(),[L,g]=k("auth_status",r.NotSure),[v,A]=k("auth_user",null),[m,U]=k("auth_token",null),[R,x]=u.useState(0);m&&(N.defaults.headers.Authorization=`Bearer ${m}`);const f=u.useCallback(()=>{c.current=N.get(o,a).then(l=>{g(r.LoggedIn),A(l.data)}).catch(l=>{console.error(l),g(r.NotLoggedIn)})},[]);if(u.useEffect(()=>{f()},[f,R]),u.useEffect(()=>{let l=0;return t>0&&(l=window.setInterval(f,Math.max(t,3e3))),()=>{clearInterval(l)}},[f,t]),L===r.NotSure&&c.current)throw c.current;return p.jsx(I.Provider,{value:{status:L,setStatus:g,user:v,setUser:A,token:m,setToken:U,fetchUser:()=>x(l=>l+1),loginPath:n,logoutRedirectPath:i,defaultAxiosOptions:a},children:e})}function d(){return u.useContext(I)}function P({to:e}){var n,i;const t=d(),o=h.useLocation();return t.status===r.LoggedIn?p.jsx(h.Navigate,{to:((i=(n=o.state)==null?void 0:n.from)==null?void 0:i.pathname)||e||"/"}):null}function b({children:e}){const t=d(),o=h.useLocation(),n=h.useNavigate();return u.useEffect(()=>{t.status===r.LoggedOut&&(n(t.logoutRedirectPath),t.setStatus(r.NotLoggedIn))},[t,n]),t.status===r.NotLoggedIn?p.jsx(h.Navigate,{to:t.loginPath,state:{from:o}}):p.jsx(p.Fragment,{children:e})}function q(e,t){const{errorHandler:o=s=>console.error(s),apiUrl:n="/login",getUserFromResponse:i=s=>s==null?void 0:s.user,getJwtTokenFromResponse:a=s=>{var S;return((S=s==null?void 0:s.token)==null?void 0:S.token)||(s==null?void 0:s.token)},actionAxiosOptions:c=null}=t||{},{setStatus:L,setUser:g,setToken:v,fetchUser:A,defaultAxiosOptions:m}=d(),[U,R]=u.useState(!1),[x,f]=u.useState(null);return{submit:()=>{R(!0),N.post(n,e,c||m||{}).then(s=>{L(r.LoggedIn),typeof i=="function"?g(i(s.data)):A(),typeof a=="function"&&v(a(s.data)),f(null)}).catch(s=>{var S;f(((S=s.response)==null?void 0:S.data)||s.message||"Unknown error"),o&&o(s)}).finally(()=>{R(!1)})},loading:U,errors:x}}function _(e){const{errorHandler:t=g=>console.error(g),apiUrl:o="/logout"}=e||{},{setStatus:n,setUser:i}=d(),[a,c]=u.useState(!1);return{submit:()=>{c(!0),N.post(o).then(()=>{n(r.LoggedOut),i(null)}).catch(t).finally(()=>{c(!1)})},loading:a}}function j(e,t){const{apiUrl:o="/register",...n}=t||{};return q(e,{apiUrl:o,...n})}function w(){const e=d(),t=h.useLocation(),o=h.useNavigate();return u.useCallback(()=>e.status===r.NotLoggedIn?(o(e.loginPath,{state:{from:t}}),!1):!0,[e,t,o])}exports.AuthProvider=O;exports.AuthStatus=r;exports.RedirectAfterAuth=P;exports.RequireAuth=b;exports.useAuth=d;exports.useLogin=q;exports.useLogout=_;exports.useRegister=j;exports.useRequireAuth=w;
